<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prefelizt | La Wishlist Universal de LatAm</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&family=Inter:wght@400;500;700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'paper': '#FDFBF7', 'ink': '#2D3436', 'lila': '#A29BFE',  
                        'mango': '#FF7675', 'menta': '#55EFC4', 
                    },
                    fontFamily: {
                        'display': ['"Archivo Black"', 'sans-serif'],
                        'body': ['"Inter"', 'sans-serif'],
                        'mono': ['"JetBrains Mono"', 'monospace'],
                    },
                    boxShadow: {
                        'neo': '4px 4px 0px 0px #2D3436',
                        'neo-pressed': '0px 0px 0px 0px #2D3436',
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #FDFBF7; color: #2D3436; }
        .neo-box { @apply bg-white border-2 border-ink rounded-xl shadow-neo transition-all; }
        /* Ocultar Honeypot visualmente pero dejarlo en el DOM para enga√±ar bots */
        .visually-hidden { position: absolute; left: -9999px; opacity: 0; }
    </style>
</head>
<body class="min-h-screen flex flex-col font-body overflow-x-hidden">

    <!-- Navbar -->
    <nav class="w-full p-6 flex justify-between items-center max-w-6xl mx-auto">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-lila border-2 border-ink rounded-lg flex items-center justify-center font-display text-xs shadow-neo">PF</div>
            <span class="font-display text-xl tracking-tight">PREFELIZT</span>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col lg:flex-row items-center justify-center gap-12 lg:gap-20 p-6 max-w-6xl mx-auto w-full">
        
        <!-- Left Column -->
        <div class="flex-1 max-w-xl text-center lg:text-left z-10">
            <div class="inline-block bg-mango text-white border-2 border-ink px-3 py-1 rounded-full text-xs font-bold font-mono shadow-neo mb-6 transform -rotate-2">
                üöß EN CONSTRUCCI√ìN
            </div>

            <h1 class="font-display text-4xl sm:text-5xl lg:text-6xl mb-6 leading-tight">
                La Wishlist Universal para <span class="text-lila">LatAm.</span>
            </h1>
            
            <p class="text-lg text-gray-600 mb-8 leading-relaxed">
                Guarda deseos de cualquier tienda. Evita regalos repetidos. S√© el primero en tener acceso.
            </p>

            <!-- SECURE FORM -->
            <form id="waitlistForm" class="flex flex-col sm:flex-row gap-4 max-w-md mx-auto lg:mx-0 relative">
                
                <!-- 1. HONEYPOT FIELD (Si un bot llena esto, lo bloqueamos) -->
                <input type="text" name="phone_check" id="honey" class="visually-hidden" tabindex="-1" autocomplete="off">

                <input type="email" id="email" required placeholder="tu@correo.com" 
                    class="flex-1 bg-white border-2 border-ink rounded-xl px-4 py-4 font-mono text-sm shadow-neo focus:outline-none focus:border-lila focus:ring-1 focus:ring-lila transition-all placeholder:text-gray-400">
                
                <button type="submit" id="submitBtn" class="bg-lila text-ink font-bold border-2 border-ink rounded-xl px-8 py-4 shadow-neo hover:translate-y-[-2px] hover:shadow-[6px_6px_0_0_#2D3436] active:translate-y-[2px] active:translate-x-[2px] active:shadow-none transition-all whitespace-nowrap">
                    Av√≠same üöÄ
                </button>

                <!-- Feedback Messages -->
                <div id="successMessage" class="absolute inset-0 bg-menta border-2 border-ink rounded-xl shadow-neo flex items-center justify-center hidden z-20">
                    <span class="font-bold text-ink">‚úÖ ¬°Listo! Te avisaremos.</span>
                </div>
                <div id="errorMessage" class="absolute inset-0 bg-mango border-2 border-ink rounded-xl shadow-neo flex items-center justify-center hidden z-20">
                    <span id="errorText" class="font-bold text-white text-sm px-4">‚ö†Ô∏è Algo fall√≥.</span>
                </div>
            </form>
            <p class="text-xs text-gray-400 mt-4 font-mono">*Protegido contra spam.</p>
        </div>

        <!-- Right Column (Visual) -->
        <div class="flex-1 w-full max-w-md lg:max-w-sm relative hidden lg:block">
            <div class="neo-box p-6 bg-white rotate-3 hover:rotate-0 transition-transform duration-500">
                <!-- Mockup Content -->
                <div class="flex items-center gap-3 mb-6 border-b-2 border-ink/10 pb-4">
                    <div class="w-10 h-10 rounded-full border-2 border-ink bg-gray-200"></div>
                    <div>
                        <div class="h-3 w-24 bg-gray-200 rounded mb-1"></div>
                        <div class="h-2 w-16 bg-gray-100 rounded"></div>
                    </div>
                </div>
                <div class="bg-paper border-2 border-ink rounded-xl overflow-hidden mb-4 h-40 flex items-center justify-center relative">
                    <span class="text-5xl">üéÅ</span>
                    <div class="absolute bottom-2 left-2 bg-ink text-white text-[10px] font-mono px-2 py-0.5 rounded">$---</div>
                </div>
                <div class="w-full bg-menta/20 text-green-800 text-[10px] font-bold text-center border border-menta rounded py-1">
                    ‚óè DISPONIBLE
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-paper border-t-2 border-ink py-8 text-center text-xs font-mono text-gray-500">
        <p>¬© 2026 Prefelizt. Security Level: MVP.</p>
    </footer>

    <script>
        // ================= CONFIGURACI√ìN =================
        const SUPABASE_URL = 'https://kekgtvjqxenefhgpwxlx.supabase.co'; 
        const SUPABASE_ANON_KEY = 'sb_publishable_g_j-6rH9FG65skiULHmh4w_OiMZHZ4G';
        // ================================================

        // 2. TIME TRAP: Registrar cu√°ndo carg√≥ la p√°gina
        const loadTime = Date.now();

        const { createClient } = supabase;
        const _supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        const form = document.getElementById('waitlistForm');
        const emailInput = document.getElementById('email');
        const honeyInput = document.getElementById('honey');
        const submitBtn = document.getElementById('submitBtn');
        const successMsg = document.getElementById('successMessage');
        const errorMsg = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // --- SEGURIDAD FRONTEND ---
            
            // A. Revisar Honeypot
            if (honeyInput.value !== "") {
                console.warn("Bot detectado (Honeypot).");
                return; // Bloqueo silencioso
            }

            // B. Revisar Tiempo (Si env√≠a en < 2 segundos, es sospechoso)
            if (Date.now() - loadTime < 2000) {
                console.warn("Env√≠o demasiado r√°pido.");
                return; 
            }

            // C. Validaci√≥n de Email b√°sica
            const email = emailInput.value.trim();
            if (!email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)) {
                showError("Email inv√°lido");
                return;
            }

            // --- ENV√çO ---

            submitBtn.disabled = true;
            submitBtn.innerText = "Guardando...";
            errorMsg.classList.add('hidden');

            try {
                const { error } = await _supabase
                    .from('waitlist')
                    .insert([{ email: email }]);

                if (error) {
                    // C√≥digo 23505 = Uniqueness Violation (Ya existe)
                    if(error.code === '23505') {
                        // Lo tratamos como √©xito para UX
                        showSuccess(); 
                    } else {
                        throw error;
                    }
                } else {
                    showSuccess();
                }

            } catch (error) {
                console.error('Error:', error);
                showError("Intenta m√°s tarde");
            }
        });

        function showSuccess() {
            successMsg.classList.remove('hidden');
            emailInput.value = '';
            confettiEffect(); // Opcional: efecto visual
        }

        function showError(msg) {
            submitBtn.disabled = false;
            submitBtn.innerText = "Av√≠same üöÄ";
            errorText.innerText = `‚ö†Ô∏è ${msg}`;
            errorMsg.classList.remove('hidden');
            setTimeout(() => errorMsg.classList.add('hidden'), 3000);
        }

        function confettiEffect() {
            // Placeholder para efecto visual simple
            submitBtn.innerText = "üéâ ¬°Gracias!";
        }
    </script>
</body>
</html>


